#!/bin/bash

# Establishes base directory of script
BASEDIR=$(dirname $0)

# Establishes script version number
SCRIPTVER=$"2017-11-12"

# Establishes binary version number
BINARYVER=$"2017.11.12"

# Establishes revision number
REVISION=$"v1.0"

# Establishes size in KB
SIZEKB=$"584"

# Check if root
if [ $USER = "root" ]; then

# Build files

# Desktop
    echo "#!/bin/bash

echo '#!/usr/bin/env xdg-open
[Desktop Entry]
Categories=Utility
Comment=
Exec=bash /usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.sh
Hidden=no
Icon=/usr/lib/tux-disc/tux-disc.png
Name=Tux Disc
Terminal=true
Type=Application
Version=$BINARYVER-$REVISION' > ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.desktop

chmod a+x ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.desktop

if [ -e ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.desktop ]; then
    echo 'Desktop file built'
else
    echo 'Failed to build desktop file'
fi" > ./create-desktop.sh

if [ -e ./create-desktop.sh ]; then
    echo 'create-desktop.sh configured'
else
    echo 'Failed to configure create-desktop.sh'
fi

# Control
    echo "#!/bin/bash

echo 'Package: tux-disc
Architecture: all
Essential: no
Maintainer: John G Laufert
Depends:
Priority: optional
Section: utilities
Version: $BINARYVER-$REVISION
Installed-Size: $SIZEKB
Description: Downloads Linux ISO of choice based on user input' > ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/control && chmod a+x ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/control

if [ -e ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/control ]; then
    echo 'Control file built'
else
    echo 'Failed to build control file'
fi" > ./create-control.sh

if [ -e ./create-control.sh ]; then
    echo 'create-control.sh configured'
else
    echo 'Failed to configure create-control.sh'
fi

# Postinst
    echo "#!/bin/bash

echo '#!/bin/bash

cp /usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.desktop /home/*/.local/share/applications/ && update-desktop-database /home/*/.local/share/applications/' > ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/postinst && chmod a+x ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/postinst

if [ -e ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/postinst ]; then
    echo 'Postinst file built'
else
    echo 'Failed to build postinst file'
fi" > ./create-postinst.sh

if [ -e ./create-postinst.sh ]; then
    echo 'create-postinst.sh configured'
else
    echo 'Failed to configure create-postinst.sh'
fi

# Prerm
    echo "#!/bin/bash

echo 'rm /home/*/.local/share/applications/tux-disc_$SCRIPTVER-$REVISION.desktop' > ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/prerm && chmod a+x ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/prerm

if [ -e ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/prerm ]; then
    echo 'Prerm file built'
else
    echo 'Failed to build prerm file'
fi" > ./create-prerm.sh

if [ -e ./create-prerm.sh ]; then
    echo 'create-prerm.sh configured'
else
    echo 'Failed to configure create-prerm.sh'
fi

# Command
    echo "#!/bin/bash

echo '#!/bin/bash

bash /usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.sh' > ./tux-disc_$SCRIPTVER-$REVISION/usr/bin/tux-disc && chmod a+x ./tux-disc_$SCRIPTVER-$REVISION/usr/bin/tux-disc

if [ -e ./tux-disc_$SCRIPTVER-$REVISION/usr/bin/tux-disc ]; then
    echo 'Command file built'
else
    echo 'Failed to command command file'
fi" > ./create-command.sh

if [ -e ./create-command.sh ]; then
    echo 'create-command.sh configured'
else
    echo 'Failed to configure create-command.sh'
fi

# Binary build
    echo "#!/bin/bash

echo 'V Folder size V'
du -sh ./tux-disc_$SCRIPTVER-$REVISION

chown -R root:root ./tux-disc_$SCRIPTVER-$REVISION/ && dpkg-deb --build ./tux-disc_$SCRIPTVER-$REVISION
rm -r ./tux-disc_$SCRIPTVER-$REVISION

if [ -e ./tux-disc_$SCRIPTVER-$REVISION.deb ]; then
    echo 'Binary file built'
else
    echo 'Failed to build binary file'
fi" > ./create-binary.sh

if [ -e ./create-binary.sh ]; then
    echo 'create-binary.sh configured'
else
    echo 'Failed to configure create-binary.sh'
fi

# Directories
    echo "#!/bin/bash

mkdir ./tux-disc_$SCRIPTVER-$REVISION
mkdir ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN
mkdir ./tux-disc_$SCRIPTVER-$REVISION/usr
mkdir ./tux-disc_$SCRIPTVER-$REVISION/usr/bin
mkdir ./tux-disc_$SCRIPTVER-$REVISION/usr/lib
mkdir ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc

if [ -d ./tux-disc_$SCRIPTVER-$REVISION ]; then
    echo 'Directories built'
else
    echo 'Failed to build directories'
fi" > ./create-directories.sh

if [ -e ./create-directories.sh ]; then
    echo 'create-directories.sh configured'
else
    echo 'Failed to configure create-directories.sh'
fi

# Move and copy files
    echo "#!/bin/bash

# Changelog
cp ./CHANGELOG.md ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/changelog

# License
cp ./LICENSE ./tux-disc_$SCRIPTVER-$REVISION/DEBIAN/copyright

# README
cp ./README.md ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/

# Script
cp ./tux-disc_$SCRIPTVER-$REVISION.sh ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/

# Tux
cp ./tux-disc.png ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/" > ./copy-files.sh

if [ -e ./copy-files.sh ]; then
    echo 'copy-files.sh configured'
else
    echo 'Failed to configure copy-files.sh'
fi

# Copy source files
    echo "#!/bin/bash

# Command
cp ./tux-disc_$SCRIPTVER-$REVISION/usr/bin/tux-disc /usr/bin/

# Folder
cp -r ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc /usr/lib/

# Desktop
cp ./tux-disc_$SCRIPTVER-$REVISION/usr/lib/tux-disc/tux-disc_$SCRIPTVER-$REVISION.desktop /home/*/.local/share/applications/ && update-desktop-database /home/*/.local/share/applications/

# Remove source folder
rm -r ./tux-disc_$SCRIPTVER-$REVISION" > ./copy-source.sh

if [ -e ./copy-source.sh ]; then
    echo 'copy-source.sh configured'
else
    echo 'Failed to configure copy-source.sh'
fi

# Remove source files
    echo "#!/bin/bash

# Command
rm /usr/bin/tux-disc

# Folder
rm -r /usr/lib/tux-disc

# Desktop
rm /home/*/.local/share/applications/tux-disc_$SCRIPTVER-$REVISION.desktop" > ./make-uninstall

if [ -e ./make-uninstall ]; then
    echo 'make-uninstall configured'
else
    echo 'Failed to configure make-uninstall'
fi

# If not run as root
else
# Message
    echo "Please run this build script as root or with sudo"
fi
